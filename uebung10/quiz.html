<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=+, initial-scale=1.0" />
    <title>Quiz</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Quiz</h1>
    <div id="init">
      <h4>Wie viele Fragen möchtest du spielen?</h4>

      <input id="amount" type="number" name="n" value="10" />
      <button id="start">Spiel starten</button>
    </div>

    <script>
      // Used as indice for questions
      var questionCount = 0;

      function startQuiz() {
        const n = document.getElementById("amount").value;
        const url = "api.php?n=" + n;

        fetchQuestions(url);
      }

      function fetchQuestions(url) {
        // Erzeuge ein neues XMLHttpRequest-Objekt
        var xmlhttp = new XMLHttpRequest();

        // Lege fest, was passieren soll, wenn sich der readystate des XMLHttpRequest-Objekts ändert
        xmlhttp.onreadystatechange = function () {
          // Wenn der Request beendet ist (readyState = 4) und alles OK war (status 200)
          if (this.readyState === 4 && this.status === 200) {
            // Wandle das Ergebnis des Requests von JSON in ein JavaScript-Objekt um
            const questions = JSON.parse(this.responseText);
            //console.log(questions);
            updateQuestions(questions, questionCount);
          }
          // Andernfalls: Wenn der Request beendet ist und nicht alles OK war
          else if (this.readyState === 4 && this.status !== 200) {
            // geben wir eine Fehlermeldung als alert aus
            alert(
              "Fragen konnten nicht abgerufen werden. Statuscode" + this.status
            );
          }
        };

        xmlhttp.open("GET", url, true);
        xmlhttp.send();
      }

      function createQuizCard(questionData) {
        document
          .getElementById("answer0")
          .addEventListener("click", checkSolution(0));
        document
          .getElementById("answer1")
          .addEventListener("click", checkSolution(1));
        document
          .getElementById("answer2")
          .addEventListener("click", checkSolution(2));

        return `<div class="card">
<h2>${questionData["question"]}</h2>
<button id="answer0">${questionData[0]["answer0"]}</button><br>
<button id="answer1">${questionData[0]["answer1"]}</button><br>
<button id="answer2">${questionData[0]["answer2"]}</button><br>
</div>
`;
      }

      function updateQuestions(questions, questionCount) {
        var container = document.getElementById("init");

        container.innerHTML = "";

        container.innerHTML = createQuizCard(questions[questionCount]);

        questionCount++;
      }

      function checkSolution(answer) {
        solution = questionData["solution"];
        if (solution == answer) {
          console.log("Richtig");
        }
        console.log(answer);
      }

      // Get initial questions once
      document.getElementById("start").addEventListener("click", startQuiz());
    </script>
  </body>
</html>
